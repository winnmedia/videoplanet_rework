# 모듈별 차등 커버리지 테스트 매트릭스\n\n## 커버리지 목표 정의\n\n각 모듈의 비즈니스 크리티컬 수준과 복잡도에 따른 차등 커버리지 목표 설정\n\n### 커버리지 임계값 정의\n\n| 모듈 | 라인 커버리지 | 브랜치 커버리지 | 함수 커버리지 | 뮤테이션 스코어 | 우선순위 |\n|------|--------------|-----------------|----------------|----------------|----------|\n| **캘린더** | 90% | 88% | 92% | 85% | 최고 |\n| **프로젝트 관리** | 88% | 85% | 90% | 80% | 높음 |\n| **대시보드** | 85% | 82% | 88% | 78% | 높음 |\n| **영상 피드백** | 82% | 79% | 85% | 75% | 중간 |\n| **영상 기획** | 75% | 72% | 78% | 70% | 중간 |\n\n## 모듈별 상세 테스트 전략\n\n### 1. 캘린더 모듈 (90% 커버리지 목표)\n**복잡도**: 높음 - 충돌 감지 알고리즘  \n**크리티컬 수준**: 최고 - 촬영 일정 관리\n\n#### 핵심 테스트 영역\n```typescript\n// 1. 충돌 감지 알고리즘 (필수 100% 커버리지)\nconst conflictDetectionTests = [\n  {\n    name: '시간 겹침 충돌 감지',\n    coverage: 100,\n    priority: 'CRITICAL',\n    scenarios: [\n      '완전 겹침',\n      '부분 겹침',\n      '시작시간 겹침',\n      '종료시간 겹침',\n      '경계값 테스트'\n    ]\n  },\n  {\n    name: '리소스 충돌 검증',\n    coverage: 100,\n    priority: 'CRITICAL',\n    scenarios: [\n      '참가자 중복',\n      '장소 중복',\n      '장비 중복',\n      '복합 리소스 충돌'\n    ]\n  },\n  {\n    name: '촬영 타입별 특수 규칙',\n    coverage: 95,\n    priority: 'HIGH',\n    scenarios: [\n      '동시 촬영 불가',\n      '편집실 동시 사용',\n      '장비 사용 우선순위'\n    ]\n  }\n]\n\n// 2. 드래그앤드롭 권한 제어 (85% 커버리지)\nconst dragDropTests = [\n  {\n    name: 'RBAC 기반 드래그 제한',\n    coverage: 90,\n    priority: 'HIGH',\n    scenarios: [\n      'Owner: 모든 일정 변경 가능',\n      'Admin: 자신 생성 일정만 변경',\n      'Editor: 읽기 전용',\n      '권한 없는 사용자 차단'\n    ]\n  }\n]\n\n// 3. 프로젝트별 색상 시스템 (80% 커버리지)\nconst colorSystemTests = [\n  {\n    name: '색상 일관성 검증',\n    coverage: 85,\n    priority: 'MEDIUM',\n    scenarios: [\n      '프로젝트 색상 자동 적용',\n      '색상 변경 시 일괄 업데이트',\n      '접근성 색상 대비 검증'\n    ]\n  }\n]\n```\n\n#### 커버리지 예외 사항\n- **10% 허용 범위**: 에러 핸들링, 디버깅 코드, 레거시 호환성 코드\n\n### 2. 프로젝트 관리 모듈 (88% 커버리지 목표)\n**복잡도**: 중간 - RBAC 권한 시스템  \n**크리티컬 수준**: 높음 - 권한 및 데이터 무결성\n\n#### 핵심 테스트 영역\n```typescript\n// 1. RBAC 권한 매트릭스 (필수 100% 커버리지)\nconst rbacTests = [\n  {\n    name: '5단계 권한 시스템',\n    coverage: 100,\n    priority: 'CRITICAL',\n    roles: ['Owner', 'Admin', 'Editor', 'Reviewer', 'Viewer'],\n    permissions: ['CREATE', 'READ', 'UPDATE', 'DELETE', 'INVITE', 'COMMENT'],\n    testMatrix: [\n      // 25개 조합 (5 roles × 5 core permissions)\n      ['Owner', 'DELETE', true],\n      ['Admin', 'DELETE', false],\n      ['Editor', 'DELETE', false],\n      ['Reviewer', 'UPDATE', false],\n      ['Viewer', 'CREATE', false]\n    ]\n  }\n]\n\n// 2. SendGrid 이메일 쿨다운 (90% 커버리지)\nconst emailTests = [\n  {\n    name: '이메일 발송 제한 로직',\n    coverage: 95,\n    priority: 'HIGH',\n    scenarios: [\n      '5분 쿨다운 적용',\n      '연속 발송 차단',\n      '쿨다운 만료 후 정상 발송',\n      'API 에러 처리'\n    ]\n  }\n]\n\n// 3. 자동 일정 생성 (85% 커버리지)\nconst autoScheduleTests = [\n  {\n    name: '3가지 프로젝트 타입별 일정',\n    coverage: 85,\n    priority: 'HIGH',\n    scenarios: [\n      'STANDARD: 기획1주+촬영1일+편집2주',\n      'RUSH: 기획3일+촬영1일+편집1주',\n      'EXTENDED: 기획2주+촬영2일+편집3주'\n    ]\n  }\n]\n```\n\n### 3. 대시보드 모듈 (85% 커버리지 목표)\n**복잡도**: 중간 - 실시간 데이터 집계  \n**크리티컬 수준**: 높음 - 사용자 핵심 인터페이스\n\n#### 핵심 테스트 영역\n```typescript\n// 1. 실시간 피드 집계 (90% 커버리지)\nconst feedAggregationTests = [\n  {\n    name: '읽지 않음 배지 로직',\n    coverage: 95,\n    priority: 'HIGH',\n    scenarios: [\n      '0-9개: 정확한 숫자 표시',\n      '10개 이상: \"9+\" 표시',\n      '실시간 카운트 업데이트',\n      '읽음 처리 시 카운트 감소'\n    ]\n  }\n]\n\n// 2. 간트 차트 요약 (85% 커버리지)\nconst ganttSummaryTests = [\n  {\n    name: '프로젝트 진행률 계산',\n    coverage: 85,\n    priority: 'MEDIUM',\n    scenarios: [\n      '다가오는 마감일 계산',\n      '지연된 작업 식별',\n      '완료율 집계',\n      '위험 수준 분류'\n    ]\n  }\n]\n\n// 3. 빠른 액션 (75% 커버리지)\nconst quickActionTests = [\n  {\n    name: '권한별 액션 필터링',\n    coverage: 80,\n    priority: 'LOW',\n    scenarios: [\n      '사용자 권한에 따른 액션 표시',\n      '액션 클릭 시 라우팅',\n      '액션 상태 관리'\n    ]\n  }\n]\n```\n\n### 4. 영상 피드백 모듈 (82% 커버리지 목표)\n**복잡도**: 높음 - 비디오 플레이어 동기화  \n**크리티컬 수준**: 중간 - 협업 도구\n\n#### 핵심 테스트 영역\n```typescript\n// 1. 비디오 플레이어 동기화 (90% 커버리지)\nconst playerSyncTests = [\n  {\n    name: '타임코드 기반 코멘트 시스템',\n    coverage: 90,\n    priority: 'HIGH',\n    scenarios: [\n      '정확한 타임스탬프 저장',\n      '코멘트 클릭 시 플레이어 이동',\n      '동시 다중 코멘트 처리',\n      '타임라인 시각화'\n    ]\n  },\n  {\n    name: '실시간 플레이어 상태 동기화',\n    coverage: 85,\n    priority: 'HIGH',\n    scenarios: [\n      '재생/일시정지 동기화',\n      'Seek 위치 동기화',\n      '재생 속도 동기화',\n      '다중 사용자 세션 관리'\n    ]\n  }\n]\n\n// 2. 스크린샷 첨부 (80% 커버리지)\nconst screenshotTests = [\n  {\n    name: '자동 스크린샷 캡처',\n    coverage: 80,\n    priority: 'MEDIUM',\n    scenarios: [\n      '현재 재생 시점 캡처',\n      '이미지 품질 설정',\n      '파일 업로드 처리',\n      '썸네일 생성'\n    ]\n  }\n]\n\n// 3. 코멘트 시스템 (75% 커버리지)\nconst commentSystemTests = [\n  {\n    name: '계층형 코멘트 구조',\n    coverage: 80,\n    priority: 'MEDIUM',\n    scenarios: [\n      '답글 시스템',\n      '우선순위 분류',\n      '해결 상태 관리',\n      '태그 시스템'\n    ]\n  }\n]\n```\n\n### 5. 영상 기획 모듈 (75% 커버리지 목표)\n**복잡도**: 최고 - LLM API 통합  \n**크리티컬 수준**: 중간 - 외부 의존성 높음\n\n#### 핵심 테스트 영역\n```typescript\n// 1. LLM 오케스트레이션 (80% 커버리지)\nconst llmTests = [\n  {\n    name: 'Google Gemini API 통합',\n    coverage: 85,\n    priority: 'HIGH',\n    scenarios: [\n      'API 성공 응답 처리',\n      '할당량 초과 에러 처리',\n      '네트워크 타임아웃 처리',\n      '응답 데이터 파싱'\n    ]\n  },\n  {\n    name: '프롬프트 엔지니어링',\n    coverage: 70,\n    priority: 'MEDIUM',\n    scenarios: [\n      '컨텍스트 기반 프롬프트 생성',\n      '응답 품질 검증',\n      '토큰 사용량 최적화'\n    ]\n  }\n]\n\n// 2. 3단계 위저드 시스템 (75% 커버리지)\nconst wizardTests = [\n  {\n    name: '위저드 플로우 관리',\n    coverage: 80,\n    priority: 'HIGH',\n    scenarios: [\n      '단계별 데이터 검증',\n      '세션 상태 관리',\n      '뒤로가기/앞으로가기',\n      '세션 타임아웃 처리'\n    ]\n  }\n]\n\n// 3. PDF 생성 파이프라인 (70% 커버리지)\nconst pdfTests = [\n  {\n    name: 'Marp 기반 PDF 생성',\n    coverage: 75,\n    priority: 'MEDIUM',\n    scenarios: [\n      '템플릿 렌더링',\n      '비동기 생성 상태 추적',\n      '다운로드 URL 생성',\n      '생성 실패 복구'\n    ]\n  }\n]\n```\n\n## Vitest 설정 업데이트\n\n모듈별 커버리지 임계값을 Vitest 설정에 반영:\n\n```typescript\n// vitest.config.ts 업데이트\nexport default defineConfig({\n  test: {\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'json', 'html', 'lcov'],\n      \n      // 글로벌 임계값 (최소 기준)\n      thresholds: {\n        lines: 75,\n        branches: 72,\n        functions: 78,\n        statements: 75\n      },\n      \n      // 모듈별 세부 임계값\n      perFile: true,\n      \n      include: [\n        'app/**/*.{ts,tsx}',\n        'widgets/**/*.{ts,tsx}',\n        'features/**/*.{ts,tsx}',\n        'entities/**/*.{ts,tsx}',\n        'shared/**/*.{ts,tsx}'\n      ],\n      \n      exclude: [\n        'node_modules/',\n        'test/',\n        '**/*.config.*',\n        '**/*.d.ts',\n        '.next/',\n        'public/',\n        '**/__mocks__/**'\n      ]\n    }\n  }\n})\n```\n\n## 모듈별 테스트 실행 스크립트\n\n```json\n{\n  \"scripts\": {\n    \"test:calendar\": \"vitest run widgets/calendar features/calendar --coverage.thresholds.lines=90\",\n    \"test:projects\": \"vitest run widgets/projects features/project --coverage.thresholds.lines=88\",\n    \"test:dashboard\": \"vitest run widgets/dashboard --coverage.thresholds.lines=85\",\n    \"test:video-feedback\": \"vitest run widgets/video-feedback features/video-feedback --coverage.thresholds.lines=82\",\n    \"test:video-planning\": \"vitest run widgets/video-planning features/video-planning --coverage.thresholds.lines=75\",\n    \n    \"test:coverage:report\": \"vitest run --coverage && node scripts/coverage-report.js\",\n    \"test:coverage:ci\": \"vitest run --coverage --reporter=json --outputFile=coverage-report.json\"\n  }\n}\n```\n\n## 커버리지 모니터링 대시보드\n\n```typescript\n// scripts/coverage-report.js\nconst fs = require('fs')\nconst path = require('path')\n\n// 모듈별 커버리지 목표\nconst coverageTargets = {\n  'calendar': { lines: 90, branches: 88, functions: 92 },\n  'projects': { lines: 88, branches: 85, functions: 90 },\n  'dashboard': { lines: 85, branches: 82, functions: 88 },\n  'video-feedback': { lines: 82, branches: 79, functions: 85 },\n  'video-planning': { lines: 75, branches: 72, functions: 78 }\n}\n\nfunction generateCoverageReport() {\n  const coverageData = JSON.parse(\n    fs.readFileSync('coverage/coverage-summary.json', 'utf8')\n  )\n  \n  const report = {\n    timestamp: new Date().toISOString(),\n    overall: coverageData.total,\n    modules: {},\n    alerts: []\n  }\n  \n  // 모듈별 커버리지 분석\n  Object.keys(coverageTargets).forEach(module => {\n    const moduleFiles = Object.keys(coverageData)\n      .filter(file => file.includes(`/${module}/`))\n    \n    if (moduleFiles.length > 0) {\n      const moduleCoverage = calculateModuleCoverage(moduleFiles, coverageData)\n      const target = coverageTargets[module]\n      \n      report.modules[module] = {\n        current: moduleCoverage,\n        target,\n        status: checkCoverageStatus(moduleCoverage, target)\n      }\n      \n      // 경고 생성\n      if (moduleCoverage.lines < target.lines) {\n        report.alerts.push({\n          module,\n          type: 'LOW_COVERAGE',\n          metric: 'lines',\n          current: moduleCoverage.lines,\n          target: target.lines,\n          gap: target.lines - moduleCoverage.lines\n        })\n      }\n    }\n  })\n  \n  // HTML 리포트 생성\n  generateHTMLReport(report)\n  \n  // Slack 알림 (CI에서)\n  if (process.env.CI && report.alerts.length > 0) {\n    sendSlackAlert(report.alerts)\n  }\n  \n  console.log('\\n📊 커버리지 리포트 생성 완료')\n  console.log(`📄 상세 리포트: file://${path.join(__dirname, '../coverage-report.html')}`)\n}\n\nfunction calculateModuleCoverage(files, coverageData) {\n  // 모듈별 커버리지 계산 로직\n  let totalLines = 0, coveredLines = 0\n  let totalBranches = 0, coveredBranches = 0\n  let totalFunctions = 0, coveredFunctions = 0\n  \n  files.forEach(file => {\n    const data = coverageData[file]\n    totalLines += data.lines.total\n    coveredLines += data.lines.covered\n    totalBranches += data.branches.total\n    coveredBranches += data.branches.covered\n    totalFunctions += data.functions.total\n    coveredFunctions += data.functions.covered\n  })\n  \n  return {\n    lines: Math.round((coveredLines / totalLines) * 100),\n    branches: Math.round((coveredBranches / totalBranches) * 100),\n    functions: Math.round((coveredFunctions / totalFunctions) * 100)\n  }\n}\n\ngenerateeCoverageReport()\n```\n\n## 성공 지표 및 모니터링\n\n### 주요 KPI\n- **모듈별 목표 달성률**: 각 모듈이 설정된 커버리지 목표 달성 여부\n- **전체 평균 커버리지**: 모든 모듈의 가중평균 커버리지\n- **커버리지 트렌드**: 주간/월간 커버리지 변화 추이\n- **빠진 테스트 케이스**: 커버되지 않은 중요 기능 식별\n\n### 알림 기준\n- **즉시 알림**: 크리티컬 모듈(캘린더, 프로젝트) 커버리지 5% 이상 하락\n- **주간 리포트**: 모든 모듈의 커버리지 현황 및 개선 권고사항\n- **월간 리뷰**: 커버리지 목표 재조정 및 테스트 전략 개선\n\n### 지속적 개선\n- **분기별 목표 재검토**: 비즈니스 우선순위 변경에 따른 커버리지 목표 조정\n- **테스트 품질 개선**: 단순 커버리지 수치를 넘어 테스트의 실제 가치 평가\n- **자동화 확대**: 커버리지 측정, 리포팅, 알림 자동화 지속 개선"