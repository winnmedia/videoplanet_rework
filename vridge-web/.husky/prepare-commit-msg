#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Auto-add branch name to commit message if it contains issue number
branch_name=$(git symbolic-ref --short HEAD)
if [[ $branch_name =~ ^(feature|fix|chore|docs|style|refactor|test|perf)\/([A-Z]+-[0-9]+) ]]; then
  issue_number="${BASH_REMATCH[2]}"
  if ! grep -q "$issue_number" "$1"; then
    echo "" >> "$1"
    echo "Refs: $issue_number" >> "$1"
  fi
fi

# Add file change summary for context
echo "" >> "$1"
echo "# Files changed:" >> "$1"
git diff --cached --name-only | sed 's/^/# /' >> "$1"