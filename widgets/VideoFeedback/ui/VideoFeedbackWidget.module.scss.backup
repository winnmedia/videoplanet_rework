/**
 * @description VideoFeedbackWidget 스타일
 * @design-system VLANET 디자인 토큰 기반, 비디오 전용 어두운 테마 적용
 */

@use '@/shared/config/design-tokens.scss' as *;

.videoFeedbackWidget {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background: $bg-primary;
  font-family: $font-primary;

  @include desktop {
    &.desktop-sidebar {
      .mainContent {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: $spacing-xl;
        height: calc(100vh - 120px);
      }
    }
  }

  @include mobile {
    &.mobile-stack {
      .mainContent {
        flex-direction: column;
        
        .videoSection {
          width: 100%;
        }

        .commentsSection {
          width: 100%;
          max-height: 50vh;
          overflow-y: auto;
        }
      }
    }
  }

  &.supports-high-contrast {
    @media (prefers-contrast: high) {
      .sessionHeader {
        border-bottom: $border-2 solid $color-gray-900;
      }

      .videoSection {
        outline: $border-1 solid $color-primary;
      }
    }
  }
}

// ===========================
// 세션 헤더
// ===========================

.sessionHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: $spacing-lg $spacing-xl;
  background: $color-white;
  border-bottom: $border-1 solid $color-gray-200;
  box-shadow: $shadow-sm;
  
  @include mobile {
    flex-direction: column;
    align-items: flex-start;
    gap: $spacing-md;
    padding: $spacing-md;
  }
}

.sessionInfo {
  flex: 1;
  
  h1 {
    font-size: $font-size-xl;
    font-weight: $font-weight-bold;
    color: $color-text-primary;
    margin: 0 0 $spacing-xs 0;
    line-height: $line-height-tight;
  }
}

.sessionMeta {
  display: flex;
  align-items: center;
  gap: $spacing-md;
  flex-wrap: wrap;
  
  @include mobile {
    flex-direction: column;
    align-items: flex-start;
    gap: $spacing-xs;
  }
}

.version {
  display: inline-flex;
  align-items: center;
  padding: $spacing-xs $spacing-sm;
  background: $color-gray-100;
  color: $color-text-secondary;
  font-size: $font-size-sm;
  font-weight: $font-weight-medium;
  border-radius: $radius-full;
}

.status {
  display: inline-flex;
  align-items: center;
  padding: $spacing-xs $spacing-md;
  font-size: $font-size-sm;
  font-weight: $font-weight-semibold;
  border-radius: $radius-full;
  text-transform: uppercase;
  letter-spacing: 0.5px;

  // 상태별 색상
  &.status-draft {
    background: rgba($color-gray-500, 0.1);
    color: $color-gray-700;
  }

  &.status-pending {
    background: rgba($color-warning, 0.1);
    color: $color-warning-dark;
  }

  &.status-in-review {
    background: rgba($color-info, 0.1);
    color: $color-info-darker;
  }

  &.status-revision-needed {
    background: rgba($color-error, 0.1);
    color: $color-error-dark;
  }

  &.status-approved {
    background: rgba($color-success, 0.1);
    color: $color-success-darker;
  }

  &.status-rejected {
    background: rgba($color-error, 0.15);
    color: $color-error;
  }

  &.status-completed {
    background: rgba($color-primary, 0.1);
    color: $color-primary;
  }
}

.duration {
  color: $color-text-secondary;
  font-size: $font-size-sm;
  font-weight: $font-weight-medium;
  font-family: $font-mono;
}

.deadline {
  color: $color-warning;
  font-size: $font-size-sm;
  font-weight: $font-weight-semibold;
  
  &:before {
    content: '⏰ ';
    margin-right: $spacing-xs;
  }
}

.statusBar {
  @include tablet {
    width: 100%;
    margin-top: $spacing-md;
  }

  &.vridge-primary {
    --primary-color: #{$color-primary};
  }
}

// ===========================
// 메인 컨텐츠
// ===========================

.mainContent {
  display: flex;
  flex: 1;
  gap: $spacing-lg;
  padding: $spacing-lg;
  
  @include mobile {
    flex-direction: column;
    padding: $spacing-md;
    gap: $spacing-md;
  }
}

.videoSection {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: $spacing-md;
  min-height: 0; // Flexbox 오버플로 방지
}

.commentsSection {
  width: 400px;
  min-height: 0;
  
  @include tablet {
    width: 320px;
  }
  
  @include mobile {
    width: 100%;
    max-height: 50vh;
  }
}

// ===========================
// 비디오 플레이어 (어두운 테마)
// ===========================

.videoPlayer {
  position: relative;
  background: $color-black;
  border-radius: $radius-lg;
  overflow: hidden;
  box-shadow: $shadow-lg;
  
  &.video-player-dark-theme {
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    
    // 비디오 플레이어 내부 컨트롤들
    .videoControls {
      background: linear-gradient(
        to top,
        rgba(0, 0, 0, 0.8) 0%,
        rgba(0, 0, 0, 0.4) 50%,
        transparent 100%
      );
    }
  }

  // 마커 표시
  .videoMarker {
    position: absolute;
    pointer-events: all;
    cursor: pointer;
    transition: $transition-all;
    z-index: $z-index-10;

    &:hover {
      transform: scale(1.1);
      filter: brightness(1.2);
    }
  }

  // 댓글 포인터
  .commentPointer {
    position: absolute;
    width: 12px;
    height: 12px;
    background: $color-primary;
    border: 2px solid $color-white;
    border-radius: $radius-full;
    cursor: pointer;
    z-index: $z-index-20;
    transition: $transition-all;

    &:hover {
      transform: scale(1.3);
      box-shadow: 0 0 0 4px rgba($color-primary, 0.3);
    }

    &.priority-urgent {
      background: $color-error;
      animation: pulse-urgent 2s infinite;
    }

    &.priority-high {
      background: $color-warning;
    }

    &.priority-medium {
      background: $color-info;
    }

    &.priority-low {
      background: $color-gray-500;
    }
  }
}

.videoControls {
  // VideoControls 컴포넌트에서 정의
}

// ===========================
// 피드백 타임라인
// ===========================

.feedbackTimeline {
  // FeedbackTimeline 컴포넌트에서 정의
}

// ===========================
// 댓글 스레드
// ===========================

.commentThread {
  // CommentThread 컴포넌트에서 정의
  height: 100%;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

// ===========================
// 로딩 및 에러 상태
// ===========================

.loadingContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 400px;
  padding: $spacing-2xl;
  background: $bg-secondary;
  border-radius: $radius-xl;

  p {
    margin-top: $spacing-lg;
    color: $color-text-secondary;
    font-size: $font-size-md;
  }
}

.spinner {
  width: 48px;
  height: 48px;
  border: 4px solid $color-gray-200;
  border-left: 4px solid $color-primary;
  border-radius: $radius-full;
  animation: spin 1s linear infinite;
}

.errorContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 400px;
  padding: $spacing-2xl;
  background: rgba($color-error, 0.05);
  border: $border-1 solid rgba($color-error, 0.2);
  border-radius: $radius-xl;
  text-align: center;

  .errorIcon {
    font-size: $font-size-4xl;
    margin-bottom: $spacing-lg;
  }

  h3 {
    font-size: $font-size-xl;
    font-weight: $font-weight-semibold;
    color: $color-error;
    margin: 0 0 $spacing-md 0;
  }

  p {
    color: $color-text-secondary;
    font-size: $font-size-md;
    margin: 0 0 $spacing-xl 0;
    max-width: 400px;
  }
}

.retryButton {
  @include button-base;
  padding: $spacing-sm $spacing-lg;
  background: $color-primary;
  color: $color-white;
  font-size: $font-size-sm;

  &:hover {
    background: $color-primary-dark;
    transform: translateY(-1px);
    box-shadow: $shadow-md;
  }

  &:active {
    transform: translateY(0);
  }
}

// ===========================
// 애니메이션
// ===========================

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes pulse-urgent {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.2);
    opacity: 0.8;
  }
}

// ===========================
// 반응형 유틸리티 클래스
// ===========================

.mobile-stack {
  @include mobile {
    .mainContent {
      flex-direction: column !important;
    }
    
    .commentsSection {
      width: 100% !important;
      max-height: 50vh;
    }
  }
}

.desktop-sidebar {
  @include desktop {
    .mainContent {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: $spacing-xl;
    }
  }
}

// ===========================
// 상태별 배지 스타일
// ===========================

.status-badge-in-review {
  color: $color-warning;
  font-weight: $font-weight-semibold;
}

.status-badge-approved {
  color: $color-success;
  font-weight: $font-weight-semibold;
}

.status-badge-revision-needed {
  color: $color-error;
  font-weight: $font-weight-semibold;
}

// ===========================
// 우선순위별 배지 스타일
// ===========================

.priority-badge-urgent {
  background: rgba($color-error, 0.1);
  color: $color-error;
  border: $border-1 solid rgba($color-error, 0.3);
}

.priority-badge-high {
  background: rgba($color-warning, 0.1);
  color: $color-warning-dark;
  border: $border-1 solid rgba($color-warning, 0.3);
}

.priority-badge-medium {
  background: rgba($color-info, 0.1);
  color: $color-info-darker;
  border: $border-1 solid rgba($color-info, 0.3);
}

.priority-badge-low {
  background: rgba($color-gray-500, 0.1);
  color: $color-gray-700;
  border: $border-1 solid rgba($color-gray-500, 0.3);
}

// ===========================
// 접근성 개선
// ===========================

// 포커스 표시 강화
.videoFeedbackWidget {
  *:focus-visible {
    outline: 2px solid $color-primary;
    outline-offset: 2px;
    border-radius: $radius-sm;
  }
}

// 고대비 모드 지원
@media (prefers-contrast: high) {
  .status,
  .priority-badge-urgent,
  .priority-badge-high,
  .priority-badge-medium,
  .priority-badge-low {
    border-width: 2px;
    font-weight: $font-weight-bold;
  }
}

// 모션 감소 설정 사용자 지원
@media (prefers-reduced-motion: reduce) {
  .spinner {
    animation: none;
  }
  
  .commentPointer {
    transition: none;
    
    &.priority-urgent {
      animation: none;
    }
  }
  
  .videoPlayer {
    .videoMarker,
    .commentPointer {
      transition: none;
    }
  }
}